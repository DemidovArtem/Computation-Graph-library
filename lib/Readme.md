# ComputeGraph library

Перед вами библиотека, в которой реализован функционал, позволяющий создавать 
графы вычислений, реализованные в потоковой манере. Кроме того, в библиотеке реализовано
решение ряда задач.

## Интерфейс графа вычислений
Граф вычислений состоит из точек входа идля данныз и операций над ними.

Ниже приведен пример построения графа, который подсчитывает количество слов в 
документе:

```python
graph = Graph.graph_from_iter('texts') \
    .map(operations.FilterPunctuation('text')) \
    .map(operations.LowerCase('text')) \
    .map(operations.Split('text')) \
    .sort(['text']) \
    .reduce(operations.Count('count'), ['text']) \
    .sort(['count', 'text'])
```

Для того, чтобы произвести вычисления при помощи полученного графа, необходимо 
вызвать метод run(), только в этот момент начинают производиться вычиления. Пример кода можно 
видеть ниже:

```python
result = graph.run('texts'=docs)
``` 

Где docs - это итератор, в котором содержатся документы, а в result записывается список с результатами
работы.

## Готовые решения

Помимо функционала, позволяющего строить графа вычислений, библиотека включает в себя решения
некоторых задач, таких как подсчет слов, построение инвертированного индекса на tf-idf,
нахождение топа слов с наибольшей взамной информацией, нахождение средней скорости движения по городу
от часа и дня недели. На любой метод, который в качестве входного потока принимает
генератор, существет его аналог, принимающий файл.

Ниже рассмотрим примеры использования каждой из фукнций.

### Word count

Приведенный ниже код позволяет построить граф вычислений, который в дальнейшем можно использовать
для подсчета слов в документах:

```python
graph = word_count_graph(
        input_stream_name,
        text_column,
        count_column
)
```

Для чтения строк из файла:

```python
graph = word_count_graph_file(
        input_stream_name,
        parser, 
        text_column, 
        count_column
)
```

Где input_stream_name - название входного потока, text_column - название колонки, в которой
находится текст документов, count_column - название колонки, в которую будет записан реузльтат - 
количество слов. Для чтения из документа parser - функций,
переводящая строку документа в строку таблицы.

### Инвертированный индекс на tf-idf

Ниже можно увидеть пример кода, который позволяет получить граф вычислений, способный выдывать
список документов, отсортированных в порядке убывания метрики tf-id:

```python
graph = inverted_index_graph(
        input_stream_name, 
        doc_column, 
        text_column,   
        result_column
)
```

Для чтения строк из файла:

```python
graph = inverted_index_graph_file(
        input_stream_name, 
        parser, 
        doc_column, 
        text_column, 
        result_column
)
```

В данном случае input_stream_name - название входного потока, doc_column - название колонки, в которой
содержится id документов, text_column - название колонки с текстом, result_column - название
колонки, в которой будет содержаться результат вычислений - значение метрики tf-idf. Для чтения из документа parser - функций,
переводящая строку документа в строку таблицы.

### Топ слов с наибольшей взаимной информацией

В данной задаче для каждого документа составляется топ слов с наибольшей взаимной информацией,
вычисленной по метрике pmi. Ниже реализован код, позволяющий построить соответстующий 
граф вычислений:

```python
graph = pmi_graph(
        input_stream_name, 
        doc_column, 
        text_column, 
        result_column
)
```

Для чтения строк из файла:

```python
graph = pmi_graph_file(
        input_stream_name, 
        parser,
        doc_column, 
        text_column, 
        result_column
)
```

В данном случае imput_stram_name - название входного потока, doc_column - название колонки, в которой
находится id документа, text_column - название колонки с текстом, result_column - название колонки, 
в котрую будет записано результирующее значение матрки pmi. Для чтения из документа parser - функций,
переводящая строку документа в строку таблицы.

### Средняя скорость движения по городу от часа и дня недели

В данном случае имеется два файла с данными - данные о времени, в которое машины находились в вершинах
некоторого графа, а также параметры ребер, соединяющих вершины этого графа. Ниже приведен пример построения графа,
который находит соответствие между днем недели и временем, и средней скоростью передвижения в 
этот момент:

```python
graphs.yandex_maps_graph(
        input_stram_name_time, input_stream_name_length,
        enter_time_column, leave_time_column, edge_id_column,
        start_coord_column, end_coord_column,
        weekday_result_column, hour_result_column, speed_result_column
)
```

Для чтения строк из файла:

```python
graphs.yandex_maps_graph(
        input_stram_name_time, input_stream_name_length, parser,
        enter_time_column, leave_time_column, edge_id_column,
        start_coord_column, end_coord_column,
        weekday_result_column, hour_result_column, speed_result_column
)
```

Где input_stram_name_time - название входного потока, из которого считываются данные о времени
нахождения в вершинах графа, input_stream_name_length - название входного потока, из которого считываются
данные о длинах ребер графа, enter_time_column - название колонки, в которой содержится время, в которое машина оказалась в 
вершине, соответствующей началу некоторого ребра, leave_time_column - название колнки, в которой содежрится время, в которое
машина оказалась в вершине, соответствующей концу некоторо ребра, edge_id_column - навзание колонки, в которой содержится id 
ребер графа, start_coord_column - название колонки, в которой содержится координата начала некоторого ребра графа в виде широты и долготы,
end_coord_column - название колонки, в которой содержится координата конца ребра графа в виде широты и долготы, weekday_result_column - 
колонка, в которой будет записан день недели, hour_result_column - название колонки, в которой будет 
записан час, speed_result_column - название колонки, в которой будет записана результирующая величина - средняя скорость.
Для чтения из документа parser - функций,
переводящая строку документа в строку таблицы.




